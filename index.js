"use strict";function _wrapRegExp(){function a(b,c,e){var f=RegExp(b,c);return d.set(f,e||d.get(b)),_setPrototypeOf(f,a.prototype)}function b(a,b){var c=d.get(b);return Object.keys(c).reduce(function(b,d){var e=c[d];if("number"==typeof e)b[d]=a[e];else{for(var f=0;void 0===a[e[f]]&&f+1<e.length;)f++;b[d]=a[e[f]]}return b},Object.create(null))}_wrapRegExp=function(b,c){return new a(b,void 0,c)};var c=RegExp.prototype,d=new WeakMap;return _inherits(a,RegExp),a.prototype.exec=function(a){var d=c.exec.call(this,a);if(d){d.groups=b(d,this);var e=d.indices;e&&(e.groups=b(e,this))}return d},a.prototype[Symbol.replace]=function(a,f){if("string"==typeof f){var g=d.get(this);return c[Symbol.replace].call(this,a,f.replace(/\$<([^>]+)(>|$)/g,function(a,b,c){if(""===c)return a;var d=g[b];return Array.isArray(d)?"$"+d.join("$"):"number"==typeof d?"$"+d:""}))}if("function"==typeof f){var h=this;return c[Symbol.replace].call(this,a,function(){var a=arguments;return"object"!=typeof a[a.length-1]&&(a=[].slice.call(a)).push(b(a,h)),f.apply(this,a)})}return c[Symbol.replace].call(this,a,f)},_wrapRegExp.apply(this,arguments)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}(function(){function a(a,b){const c=b?/\{name:\S+\}/:/\{name\}/;return{contains:c.test(a),exactMatch:new RegExp("^".concat(c.source,"$")).test(a)}}function b(a,b){return Array.isArray(a)&&2===a.length&&"get"===a[0]&&"string"==typeof a[1]&&(!b||a[1].startsWith("name:"))&&(b||"name"===a[1])}function c(a,c,d){const e=structuredClone(a),f=a=>{if("string"!=typeof a)for(let e=0;e<a.length;e+=1)b(a[e],d)?a[e]=structuredClone(c):f(a[e])};return b(e,d)?c:(f(e),e)}function d(a){return(Array.isArray(a)&&2===a.length&&"get"===a[0]&&"string"==typeof a[1]?"name"===a[1].trim()?{isLanguage:!0,localization:null}:a[1].trim().startsWith("name:")?{isLanguage:!0,localization:a[1].trim().split(":").pop()}:null:null)}function e(a){const b=[],c=structuredClone(a),e=a=>{if("string"!=typeof a)for(let c=0;c<a.length;c+=1){const f=d(a[c]);f?b.push(f.localization):e(a[c])}};return e([c]),b}function f(a){const b=_wrapRegExp(/\{name(?::(\S+))?\}/g,{language:1}),c=[];for(;;){var d,e;const f=b.exec(a);if(!f)break;const g=null!==(d=null===(e=f.groups)||void 0===e?void 0:e.language)&&void 0!==d?d:null;c.push(g)}return c}function g(a,b){const c=[];for(const d of a){if("symbol"!==d.type)continue;const a=d,{id:g,layout:h}=a;if(!h)continue;if(!("text-field"in h))continue;const i=b.getLayoutProperty(g,"text-field");i&&("string"==typeof i?c.push(f(i)):c.push(e(i)))}const d=c.flat(),g={unlocalized:0,localized:{}};for(const c of d)null===c?g.unlocalized+=1:(c in g.localized||(g.localized[c]=0),g.localized[c]+=1);return g}function h(){if("undefined"==typeof navigator){const a=Intl.DateTimeFormat().resolvedOptions().locale,b=a.split("-")[0];return i.includes(a)?"name:"+a:i.includes(b)?"name:"+b:"name:en"}const a=navigator.languages.flatMap(a=>{let b=[];for(;a.includes("-");)b.push(j[a.toLowerCase()]||a),a=a.substring(0,a.lastIndexOf("-"));return b.push(a),b.filter(a=>i.includes(a))}),b=Array.from(new Set(a));return b[0]?"name:"+b[0]:"name"}const i=["latin","nonlatin","am","ar","az","be","bg","bn","br","bs","ca","co","cs","cy","da","de","el","en","eo","es","et","eu","fa","fi","fr","fy","ga","gd","he","hi","hr","hu","hy","id","is","it","ja","ja-Hira","ja-Latn","ja_kana","ja_rm","ka","kk","kn","ko","ko-Latn","ku","la","lb","lt","lv","mk","ml","mt","nl","no","oc","pa","pl","pnb","pt","rm","ro","ru","sk","sl","sq","sr","sr-Latn","sv","ta","te","th","tr","uk","vi","zh","zh-Hans","zh-Hant"],j={"zh-cn":"zh-Hans","zh-hk":"zh-Hant","zh-mo":"zh-Hant","zh-sg":"zh-Hans","zh-tw":"zh-Hant"};maplibregl.Map.prototype.supportedLanguages=i,maplibregl.Map.prototype.getStyleLanguage=function a(){return this.style&&this.style.stylesheet&&this.style.stylesheet.metadata?"object"==typeof this.style.stylesheet.metadata?"maptiler:language"in this.style.stylesheet.metadata&&"string"==typeof this.style.stylesheet.metadata["maptiler:language"]?this.style.stylesheet.metadata["maptiler:language"]:null:null:null},maplibregl.Map.prototype.onStyleReady=function b(a){this.isStyleLoaded()?a():this.once("styledata",()=>{a()})},maplibregl.Map.prototype.setLanguage=function b(a){this.onStyleReady(()=>{this.setPrimaryLanguage(a)})},maplibregl.Map.prototype,maplibregl.Map.prototype.setPrimaryLanguage=function d(b){var e;const f=["name","auto","style","visitor","visitor_en"].includes(b);if(!f&&!i.includes(b))return void console.warn("The language \"".concat(b,"\" is not supported."));const j=f?b:"name:"+b,k=this.getStyleLanguage();if("style"!==j||"auto"!==k&&"visitor"!==k){if("style"!==j&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle)return;if(this.primaryLanguage===j&&!this.forceLanguageUpdate)return}if("style_lock"===this.primaryLanguage)return void console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");this.primaryLanguage=j;let l=j;if("style"===j){if(!k)return void console.warn("The style has no default languages or has an invalid one.");l=k}let m="name",n=["get",m];"visitor"===l?(m=h(),n=["case",["all",["has",m],["has","name"]],["case",["==",["get",m],["get","name"]],["get","name"],["format",["get",m],{"font-scale":.8},"\n",["get","name"],{"font-scale":1.1}]],["get","name"]]):"visitor_en"===l?(m="name:en",n=["case",["all",["has",m],["has","name"]],["case",["==",["get",m],["get","name"]],["get","name"],["format",["get",m],{"font-scale":.8},"\n",["get","name"],{"font-scale":1.1}]],["get","name"]]):"auto"===l?(m=h(),n=["coalesce",["get",m],["get","name"]]):"name"===l?(m="name",n=["get",m]):(m=l,n=["coalesce",["get",m],["get","name"]]);const{layers:o}=this.getStyle();null!==(e=this.originalLabelStyle)&&void 0!==e?e:this.originalLabelStyle=new Map;const p=0===this.originalLabelStyle.size;if(p){const a=g(o,this);this.isStyleLocalized=0<Object.keys(a.localized).length}for(const d of o){if("symbol"!==d.type)continue;const b=this.getSource(d.source);if(!b)continue;if(!("url"in b&&"string"==typeof b.url))continue;const e=new URL(b.url);if("api.maptiler.com"!==e.host)continue;const{id:f,layout:g}=d;if(!g||!("text-field"in g))continue;let h;if(p?(h=this.getLayoutProperty(f,"text-field"),this.originalLabelStyle.set(f,h)):h=this.originalLabelStyle.get(f),"string"==typeof h){const{contains:b,exactMatch:c}=a(h,this.isStyleLocalized);if(!b)continue;c?this.setLayoutProperty(f,"text-field",n):this.setLayoutProperty(f,"text-field",replaceLanguage(h,n,this.isStyleLocalized))}else this.setLayoutProperty(f,"text-field",c(h,n,this.isStyleLocalized))}}})();
